dist: trusty
jdk: oraclejdk8
language: java
sudo: true
services:
  - postgresql
  - docker
addons:
  apt:
    packages:
      - oracle-java8-installer
before_install:
  - chmod +x mvnw
env:
  global:
    - secure: "RJKr2na1bMhVYyfLP48cZrd+QO35LfM6Yn9pZD5EIz1kfNNU91ViSgfScDFdE5Ixizczkiz6ABm3ZxOf9wRpNqN7pIBqLcmqND64j4E3UIw2RMVBf9E0lGxNbodMQe1+X5ExOcpR+97sFpD7JTCpsLtakO6GHi75dJJqlt4ZD+xwcr51eoJUeliOF0aMAK8vdhLU1EkaE3FYdG/hCKX+dWWFT3j96QmRviJo10P52QJaLuCUV2hCbDhxKVdEKgiF1O/OEFfCjh9RjRfSdBqx3W9WP9QvbawRUrTS3s9Apf/TFvAda31O5CTmDmfxjUxDjXlS3e4r2puQWyhiCpwQYBicr3Y+L2AIHhI5cgYOGUfNSe5ZOBR4/4ukxdaq4tRt+epjHfoNARGpbghni01IoeRL1RyKdslIuJSKtGodXqJKpEpGs7j/tsLxGKo0irQGTmVRbL3KxHHHVVMmkDPQQqWnT5Vwx6yrWfXL6TOfE3VpWmJNh6/SptLArciC0L2waU+ccL/V3kmk8voUFtcial7johPuiKBgnXvxvoAfta7eTz3XDAKxnlWzTg/Nj7z4LjDMxnUnhdVYO0gb6HbGJfpraJleJ3pryLn+R+KYJmEg1VRjjF9Sh+WW97d+mmfgMXKnBvI0ri3m+alyOsVsOsC9cS2QoeoCmNAynGlUJ2A="
    - secure: "SbGXJpVn3MKCEy02rRFbCaY/OHi4YVuc6H+ziZHwhGPlPrcjbQAsxzrV4fBzv7CeT+pf1Ty4oDcnWfXXcwj8OgxLuAhcLFpMsJHncxw4VdgSekoyqOjHYPuakVQLY5kF5QJHeOW/wIidQfzKrTEnwI6gDbSTrVX62cpNlyWItv+JCTnB8hKWsIhcgs3cOY8qsQqE4N6J6rpBV5nBSHgjklDLNaVaiuPdnWhScq7raFrk4OVEGA/ddVMjS9JtZoolPN2SQFp4HAjwsQ8VEcInCgAEdBPZEs911NsA/XUCwffs7hz1F/1gSjqoA7+siu/O6m34L1bQ0sCC19goFRKyj1X1ZChBdeU5V5J75VrgGYOYiweMT8E6sWXmmJ4zNEGsq3Z3XhVMMrBy73wgpcfv6yb8uWvETfolywSSo3A37PPKC+TiWYs4CTcpmNUxohwtB5kdt+epp+VTOImHtXM3hk5xEoFL8dgjpajYyVyMy7KahvdTyScXtoZD3rRwW5T1/t7N2rQ7sJ3jpCdcKtx6xSjtXMPTheeZg1QFJ2w9v0eydbiaL/QNNiAm6Oepc+PJQ3bzR8xgi5Q4T2I1y0H0ayrchtjrEQCA9V4ZQNUroobUPbWDOsatumDFa3iXMMMKnAgBP/+OomNuKREq50CrSgVyFI8dkbUB0gFtdGHOVL8="
    - secure: "OFQvIO1EZUYyCgmzEdFhvBPEQ9hibC0rOOez7aCkQTYtUhlrQ4thvlnVyFyOc5/F8rHR+BzCkOA+10XRo6EoesyiK2IHPAw8IH6yilR4RmkEISZQQOe5mll1ahSmlaa5la7crqI2HNPNlxMt27Q9A86JnnDdx3gmPXLXw56c/I0rZA8xmsVi8DISNCxOgGDu/prO2v41NixPAboaV6+l0pOiO3kqfxUlt/h18/3Rstel+sK9FMBzxMhFp2CXIJgL9PNleJ35SM+zRiTeQ6jwzvCgC5Harx4l6V6J/BZkfSiGs+Jm/OKUYaPDJoOeVRSIsnnVKNjr/XAs/yGESs5pG/5KHL7vW5J/j19iT5FnZPVQtJMs0J7cGZZr4YXkHJJRQBtyzFbpOrwW5Xi41IgsU3MyN3OYiiUi1Z5Lbn6+HsCCtW1h3qClXC9UnHiI4bCTLbENLqtd9bV6gav/NusZKBkU2B3V8Mz5ycFhXcw1vgurQvGAF04rj6TQmQtDPl1HEdiTEtzUkJUyoe5DERNf6OEqdxHW1NeA3Uy7o1fmL4ui/AjaTxOYBCCqSVlnuSGitT4Lk4aEttoaJgjHe7n34JgqtlOsZtXf4N741/zAYh+8beMZA590Ejj3g225dqM3Q+PqmOjRovRynM3Pe3PQ6umWQ5MnzQdiRZpLmS3JjP8="
    - COMMIT=${TRAVIS_COMMIT::7}
script:
  - ./mvnw clean install -B
after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo "$TRAVIS_BRANCH"; fi`
  - export IMAGE_NAME=myapi/main-repo
  - docker build -t $IMAGE_NAME:latest .
  - docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME:$TAG
deploy:
  provider: heroku
  api_key: $HEROKU_API_KEY
  app: myapi-api